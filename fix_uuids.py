#!/usr/bin/env python3
"""
快速修复database-init.sql中的UUID格式问题
将所有以字母开头的UUID替换为以数字开头的标准格式
"""

import re

def fix_uuids():
    # 读取文件
    with open('database-init.sql', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 定义替换映射
    replacements = {
        # content_analytics 表
        'a0000001-1111-1111-1111-111111111111': '10000001-1111-1111-1111-111111111111',
        'a0000002-2222-2222-2222-222222222222': '10000002-2222-2222-2222-222222222222',
        'a0000003-3333-3333-3333-333333333333': '10000003-3333-3333-3333-333333333333',
        'a0000004-4444-4444-4444-444444444444': '10000004-4444-4444-4444-444444444444',
        'a0000005-5555-5555-5555-555555555555': '10000005-5555-5555-5555-555555555555',
        'a0000006-6666-6666-6666-666666666666': '10000006-6666-6666-6666-666666666666',
        'a0000007-7777-7777-7777-777777777777': '10000007-7777-7777-7777-777777777777',
        'a0000008-8888-8888-8888-888888888888': '10000008-8888-8888-8888-888888888888',
        'a0000009-9999-9999-9999-999999999999': '10000009-9999-9999-9999-999999999999',
        'a000000a-aaaa-aaaa-aaaa-aaaaaaaaaaaa': '1000000a-aaaa-aaaa-aaaa-aaaaaaaaaaaa',
        
        # contents 表
        'c0000001-1111-1111-1111-111111111111': '20000001-1111-1111-1111-111111111111',
        'c0000002-2222-2222-2222-222222222222': '20000002-2222-2222-2222-222222222222',
        'c0000003-3333-3333-3333-333333333333': '20000003-3333-3333-3333-333333333333',
        'c0000004-4444-4444-4444-444444444444': '20000004-4444-4444-4444-444444444444',
        'c0000005-5555-5555-5555-555555555555': '20000005-5555-5555-5555-555555555555',
        
        # usage_statistics 表
        'u0000001-1111-1111-1111-111111111111': '30000001-1111-1111-1111-111111111111',
        'u0000002-2222-2222-2222-222222222222': '30000002-2222-2222-2222-222222222222',
        'u0000003-3333-3333-3333-333333333333': '30000003-3333-3333-3333-333333333333',
        'u0000004-4444-4444-4444-444444444444': '30000004-4444-4444-4444-444444444444',
        'u0000005-5555-5555-5555-555555555555': '30000005-5555-5555-5555-555555555555',
        'u0000006-6666-6666-6666-666666666666': '30000006-6666-6666-6666-666666666666',
        'u0000007-7777-7777-7777-777777777777': '30000007-7777-7777-7777-777777777777',
        'u0000008-8888-8888-8888-888888888888': '30000008-8888-8888-8888-888888888888',
        
        # plan_upgrade_history 表
        'h0000001-1111-1111-1111-111111111111': '40000001-1111-1111-1111-111111111111',
        'h0000002-2222-2222-2222-222222222222': '40000002-2222-2222-2222-222222222222',
        'h0000003-3333-3333-3333-333333333333': '40000003-3333-3333-3333-333333333333',
        
        # system_settings 表
        's0000001-1111-1111-1111-111111111111': '50000001-1111-1111-1111-111111111111',
        's0000002-2222-2222-2222-222222222222': '50000002-2222-2222-2222-222222222222',
        's0000003-3333-3333-3333-333333333333': '50000003-3333-3333-3333-333333333333',
        's0000004-4444-4444-4444-444444444444': '50000004-4444-4444-4444-444444444444',
        's0000005-5555-5555-5555-555555555555': '50000005-5555-5555-5555-555555555555',
        's0000006-6666-6666-6666-666666666666': '50000006-6666-6666-6666-666666666666',
        's0000007-7777-7777-7777-777777777777': '50000007-7777-7777-7777-777777777777',
        's0000008-8888-8888-8888-888888888888': '50000008-8888-8888-8888-888888888888',
        's0000009-9999-9999-9999-999999999999': '50000009-9999-9999-9999-999999999999',
        's000000a-aaaa-aaaa-aaaa-aaaaaaaaaaaa': '5000000a-aaaa-aaaa-aaaa-aaaaaaaaaaaa',
    }
    
    # 执行替换
    for old_uuid, new_uuid in replacements.items():
        content = content.replace(old_uuid, new_uuid)
    
    # 写回文件
    with open('database-init.sql', 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("UUID修复完成！")

if __name__ == '__main__':
    fix_uuids()
